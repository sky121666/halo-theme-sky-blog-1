<!-- 文档内容页 - 现代全宽文档风格 -->
<div th:fragment="content" class="doc-layout">

  <!-- 左侧文档树 - 固定定位 -->
  <aside class="doc-sidebar hidden lg:block">
    <div class="doc-sidebar-inner scrollbar-thin">

      <!-- 版本选择器 - 仅当有多个版本时显示 -->
      <th:block th:if="${#lists.size(versions) > 1}">
        <div class="doc-version-selector">
          <button class="doc-version-btn" onclick="this.nextElementSibling.classList.toggle('show')" type="button">
            <span class="flex items-center gap-2">
              <span class="icon-[heroicons--tag] w-4 h-4"></span>
              <span th:text="${currentVersion.spec.slug}">版本</span>
            </span>
            <span class="icon-[heroicons--chevron-down] w-4 h-4"></span>
          </button>
          <div class="doc-version-dropdown">
            <a th:each="version : ${versions}" th:href="${version.status.permalink}" class="doc-version-item"
              th:classappend="${version.metadata.name == currentVersion.metadata.name} ? 'active' : ''">
              <span th:text="${version.spec.slug}">版本名</span>
            </a>
          </div>
        </div>
      </th:block>

      <!-- 语言选择器 - 仅当有多个语言时显示 -->
      <th:block th:if="${#lists.size(languages) > 1}">
        <div class="doc-version-selector">
          <button class="doc-version-btn" onclick="this.nextElementSibling.classList.toggle('show')" type="button">
            <span class="flex items-center gap-2">
              <span class="icon-[heroicons--language] w-4 h-4"></span>
              <span th:if="${currentLanguage != null}" th:text="${currentLanguage.label}">语言</span>
              <span th:unless="${currentLanguage != null}">语言</span>
            </span>
            <span class="icon-[heroicons--chevron-down] w-4 h-4"></span>
          </button>
          <div class="doc-version-dropdown">
            <a th:each="language : ${languages}" th:href="${language.link}" class="doc-version-item">
              <span th:text="${language.label}">语言名</span>
            </a>
          </div>
        </div>
      </th:block>

      <!-- 项目标题 -->
      <a th:href="${project.status.permalink}" class="doc-project-title">
        <span class="icon-[heroicons--book-open] w-5 h-5 text-primary shrink-0"></span>
        <span class="truncate" th:text="${project.spec.displayName}">文档项目</span>
      </a>

      <!-- 文档树导航 -->
      <ul class="doc-nav-tree">
        <th:block th:replace="~{modules/doc-content :: tree-item(docTrees=${docTrees})}" />
      </ul>
    </div>
  </aside>

  <!-- 主内容区 -->
  <main class="doc-main">
    <div class="doc-content-wrapper">

      <!-- 访问限制提示 - 非公开文档 -->
      <div th:if="${project?.spec != null and project.spec['public'] == false}" class="doc-restricted-banner">
        <span class="icon-[heroicons--lock-closed] w-5 h-5 shrink-0"></span>
        <span>此文档仅对登录用户可见</span>
      </div>

      <!-- 面包屑 -->
      <nav class="doc-breadcrumb" aria-label="面包屑导航">
        <a th:href="${project.status.permalink}" class="flex items-center gap-1">
          <span class="icon-[heroicons--home] w-4 h-4"></span>
          <span th:text="${project.spec.displayName}">首页</span>
        </a>
        <th:block th:each="crumb : ${crumbs}">
          <span class="icon-[heroicons--chevron-right] w-3 h-3 opacity-40"></span>
          <a th:href="${crumb.status.permalink}" th:text="${crumb.spec.title}">分类</a>
        </th:block>
      </nav>

      <!-- 文档标题 -->
      <h1 class="doc-title" th:text="${docTree.spec.title}">文档标题</h1>

      <!-- 文档正文内容 -->
      <article class="doc-article">
        <div id="doc-content"
          class="prose prose-lg max-w-none" th:utext="${docInfo.content.content}">
          文档内容
        </div>
      </article>

      <!-- 互动卡片 - 作者/分享/翻页 -->
      <div class="card bg-base-100/80 backdrop-blur-xl shadow-lg border border-base-content/5 rounded-2xl mt-8">
        <div class="card-body p-4 sm:p-6">
          <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">

            <!-- 左侧：作者信息 + 分享 -->
            <div class="flex items-center gap-4">
              <!-- 作者头像+信息 -->
              <div th:if="${docInfo.doc.spec.owner}" class="flex items-center gap-3">
                <!-- 头像 - 使用项目图标或默认头像 -->
                <div class="avatar">
                  <div class="w-10 h-10 rounded-full ring ring-primary/20 ring-offset-base-100 ring-offset-1">
                    <img th:if="${project?.spec?.icon}" th:src="${project.spec.icon}" alt="作者头像" />
                    <div th:unless="${project?.spec?.icon}" class="bg-primary/10 w-full h-full flex items-center justify-center">
                      <span class="icon-[heroicons--user] w-5 h-5 text-primary"></span>
                    </div>
                  </div>
                </div>
                <!-- 作者名+时间 -->
                <div class="flex flex-col">
                  <span class="text-sm font-medium text-base-content" th:text="${docInfo.doc.spec.owner}">作者名</span>
                  <div class="flex items-center gap-2 text-xs text-base-content/50">
                    <span th:if="${docInfo.doc.spec.updatedAt}" 
                          th:text="${'更新于 ' + #strings.substring(docInfo.doc.spec.updatedAt.toString(), 0, 10)}">
                      更新于 2025-01-01
                    </span>
                  </div>
                </div>
              </div>

              <!-- 分隔线 -->
              <div class="divider divider-horizontal mx-0 h-8 hidden sm:flex"></div>

              <!-- 分享按钮 - 使用文档独立配置 -->
              <button th:if="${theme.config.docsme.doc_settings?.enable_share != false}" 
                x-data @click="$dispatch('open-share-modal')"
                class="btn btn-sm btn-ghost bg-base-200 border-0 rounded-full gap-2 transition-all duration-200 hover:bg-primary/10 hover:text-primary">
                <span class="icon-[heroicons--share] w-5 h-5"></span>
                <span class="hidden sm:inline">分享</span>
              </button>
            </div>

            <!-- 右侧：翻页导航 -->
            <div th:if="${linkNavigation}" class="flex gap-2 w-full sm:w-auto sm:max-w-[60%]">
              <!-- 上一篇 -->
              <a th:if="${linkNavigation.hasPrevious}" th:href="${linkNavigation.previous.link}"
                class="flex-1 btn btn-ghost bg-base-200 border-0 rounded-xl h-auto py-2 px-3 flex-nowrap justify-start gap-2 hover:bg-primary/10 hover:text-primary group overflow-hidden">
                <span class="icon-[heroicons--arrow-left] w-4 h-4 shrink-0 opacity-60 group-hover:opacity-100 transition-all group-hover:-translate-x-0.5"></span>
                <div class="flex flex-col items-start min-w-0 overflow-hidden">
                  <span class="text-[10px] opacity-50">上一篇</span>
                  <span class="text-xs font-medium truncate w-full" th:text="${linkNavigation.previous.title}">上一篇标题</span>
                </div>
              </a>
              <div th:unless="${linkNavigation.hasPrevious}"
                class="flex-1 btn btn-ghost bg-base-200/50 border-0 rounded-xl h-auto py-2 px-3 flex-nowrap justify-start gap-2 opacity-40 cursor-not-allowed no-animation">
                <span class="icon-[heroicons--arrow-left] w-4 h-4 shrink-0 opacity-60"></span>
                <div class="flex flex-col items-start">
                  <span class="text-[10px] opacity-50">上一篇</span>
                  <span class="text-xs font-medium">没有了</span>
                </div>
              </div>

              <!-- 下一篇 -->
              <a th:if="${linkNavigation.hasNext}" th:href="${linkNavigation.next.link}"
                class="flex-1 btn btn-ghost bg-base-200 border-0 rounded-xl h-auto py-2 px-3 flex-nowrap justify-end gap-2 hover:bg-primary/10 hover:text-primary group overflow-hidden">
                <div class="flex flex-col items-end min-w-0 overflow-hidden">
                  <span class="text-[10px] opacity-50">下一篇</span>
                  <span class="text-xs font-medium truncate w-full text-right" th:text="${linkNavigation.next.title}">下一篇标题</span>
                </div>
                <span class="icon-[heroicons--arrow-right] w-4 h-4 shrink-0 opacity-60 group-hover:opacity-100 transition-all group-hover:translate-x-0.5"></span>
              </a>
              <div th:unless="${linkNavigation.hasNext}"
                class="flex-1 btn btn-ghost bg-base-200/50 border-0 rounded-xl h-auto py-2 px-3 flex-nowrap justify-end gap-2 opacity-40 cursor-not-allowed no-animation">
                <div class="flex flex-col items-end">
                  <span class="text-[10px] opacity-50">下一篇</span>
                  <span class="text-xs font-medium">没有了</span>
                </div>
                <span class="icon-[heroicons--arrow-right] w-4 h-4 shrink-0 opacity-60"></span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- 评论卡片 - 使用 project.spec.enableComment 判断是否启用评论 -->
      <div th:if="${project?.spec?.enableComment == true}"
        class="card bg-base-100/80 backdrop-blur-xl shadow-lg border border-base-content/5 rounded-2xl mt-4 overflow-hidden">
        <!-- 评论区标题 -->
        <div class="flex items-center justify-between px-4 sm:px-6 py-3 border-b border-base-content/5 bg-base-200/30">
          <div class="flex items-center gap-2 text-sm font-semibold text-base-content">
            <span class="icon-[heroicons--chat-bubble-left-right] w-4 h-4 text-primary"></span>
            <span>评论交流</span>
          </div>
        </div>
        <!-- Halo 评论组件 - 使用 docInfo.doc.metadata.name 作为评论关联名称 -->
        <div class="card-body p-4 sm:p-6">
          <halo:comment group="run.halo.docsme" kind="Doc" th:attr="name=${docInfo.doc.metadata.name}" colorScheme="system" />
        </div>
      </div>
    </div>
  </main>

  <!-- 右侧目录 - 固定定位，与文章页目录样式一致 -->
  <aside class="doc-toc hidden xl:block">
    <div id="toc-card" class="doc-toc-card">
      <h3 class="text-xs font-bold text-base-content/40 uppercase tracking-wider mb-4 flex items-center gap-2">
        <span class="icon-[heroicons--list-bullet] w-4 h-4"></span>
        <span>本页目录</span>
      </h3>
      <div class="toc-container overflow-y-auto pr-2 scrollbar-thin">
        <nav id="toc-nav" class="space-y-1" role="navigation" aria-label="文档目录">
        <!-- 目录将由 JavaScript 自动生成 -->
      </nav>
      </div>
    </div>
  </aside>

</div>

<!-- 分享弹窗 - 使用文档独立配置 -->
<th:block th:if="${theme.config.docsme.doc_settings?.enable_share != false}" 
  th:replace="~{modules/share-modal :: shareModal(
    title='分享文档',
    shareUrl=${docTree.status.permalink},
    shareTitle=${docTree.spec.title},
    shareItemIds=${theme.config.docsme.doc_settings.share_settings.share_item_ids}
  )}" />

<!-- 递归渲染文档树 - 参考 Docsme 官方模板 -->
<th:block th:fragment="tree-item(docTrees)">
  <li th:each="currentDocTree : ${docTrees}">
    <!-- 文档链接 -->
    <a th:if="${currentDocTree.spec.type == 'DOC'}" th:href="${currentDocTree.status.permalink}"
      th:title="${currentDocTree.spec.title}"
      th:classappend="${currentDocTree.metadata.name == docTree.metadata.name} ? 'active' : ''">
      <span th:text="${currentDocTree.spec.title}" class="truncate">标题</span>
    </a>
    <!-- 目录（可展开 + 可点击导航至目录页） -->
    <details th:if="${currentDocTree.spec.type == 'TREE'}" th:id="${currentDocTree.metadata.name}"
      th:open="${#arrays.contains(crumbs, currentDocTree) || currentDocTree.metadata.name == docTree.metadata.name}">
      <summary th:title="${currentDocTree.spec.title}">
        <a th:href="${currentDocTree.status.permalink}" th:text="${currentDocTree.spec.title}"
          th:classappend="${currentDocTree.metadata.name == docTree.metadata.name} ? 'active' : ''"
          class="truncate doc-nav-folder-link">分类标题</a>
      </summary>
      <ul th:if="${currentDocTree.children != null && !currentDocTree.children.isEmpty()}">
        <th:block th:replace="~{modules/doc-content :: tree-item(docTrees=${currentDocTree.children})}" />
      </ul>
    </details>
  </li>
</th:block>