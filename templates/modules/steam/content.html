<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org">

<!-- ========================================== -->
<!--        Steam Ê∏∏ÊàèÂ∫ì‰∏ª‰ΩìÂÜÖÂÆπ (ÂºÇÊ≠•Âä†ËΩΩ)      -->
<!-- ========================================== -->

<main class="steam-page relative" th:fragment="steam-content"
  x-data="steamPage()" x-init="init()">

  <div class="max-w-6xl mx-auto px-4 py-8">

    <!-- ÈîôËØØÊèêÁ§∫ -->
    <div x-show="error" x-cloak class="alert alert-warning mb-6 rounded-2xl steam-animate-in">
      <span class="icon-[heroicons--exclamation-triangle] w-5 h-5"></span>
      <span x-text="error">ÈÉ®ÂàÜ Steam Êï∞ÊçÆÂä†ËΩΩÂ§±Ë¥•ÔºåËØ∑Á®çÂêéÂà∑Êñ∞ÈáçËØïÊàñÊ£ÄÊü•Êèí‰ª∂ÈÖçÁΩÆ„ÄÇ</span>
    </div>

    <!-- ========================================== -->
    <!--     ‰∏§Ê†èÂ∏ÉÂ±Ä - Steam ÂÆòÊñπÈ£éÊ†º              -->
    <!-- ========================================== -->
    <div class="steam-layout steam-animate-in">

      <!-- ================================ -->
      <!-- Â∑¶‰æß‰∏ªÊ†è                          -->
      <!-- ================================ -->
      <div class="steam-main">

        <!-- Profile Header - È™®Êû∂Â±è -->
        <div x-show="loading.profile" class="steam-profile-header">
          <div class="steam-profile-avatar">
            <div class="skeleton w-20 h-20 rounded-full"></div>
          </div>
          <div class="steam-profile-info">
            <div class="skeleton h-7 w-32 mb-2"></div>
            <div class="skeleton h-4 w-24"></div>
          </div>
        </div>

        <!-- Profile Header - ÂÆûÈôÖÂÜÖÂÆπ -->
        <div x-show="!loading.profile && profile" x-cloak class="steam-profile-header">
          <div class="steam-profile-avatar" :class="profile?.playing ? 'playing' : ''">
            <img :src="profile?.summary?.avatarfull" :alt="profile?.summary?.personaname"
                 loading="eager" decoding="async" class="steam-avatar-img" />
          </div>
          <div class="steam-profile-info">
            <div class="flex items-center gap-2">
              <h1 class="steam-profile-name" x-text="profile?.summary?.personaname">Steam User</h1>
              <!-- Level Badge -->
              <span class="badge badge-outline gap-1 font-mono"
                :class="(badges?.playerLevel || profile?.steamLevel || 0) >= 100 ? 'badge-warning' : 'badge-neutral'"
                style="border-color: var(--color-primary); color: var(--color-primary);">
                <span class="text-xs">Lv.</span>
                <span class="font-bold" x-text="badges?.playerLevel || profile?.steamLevel || 0">0</span>
              </span>
            </div>

            <!-- Status -->
            <div class="steam-status-subtitle flex items-center gap-2 text-sm mt-1">
              <span class="w-2 h-2 rounded-full"
                :class="profile?.playing ? 'bg-success' : (profile?.summary?.personastate == 1 ? 'bg-info' : 'bg-base-content/30')"></span>
              <span x-text="profile?.statusText" class="opacity-70">Âú®Á∫ø</span>
            </div>
          </div>
        </div>

        <!-- ÊúÄÊñ∞Âä®ÊÄÅ (ÁÉ≠ÂäõÂõæ) -->
        <div th:if="${showHeatmap}" class="steam-activity-section">
          <div class="steam-heatmap-inline relative">
            <div class="heatmap-container relative min-h-[120px]">
              <div id="steam-heatmap-grid" class="steam-heatmap-grid" th:data-days="${heatmapDays}"
                th:data-api-url="@{/apis/api.steam.halo.run/v1alpha1/heatmap/records}"></div>

              <div id="steam-heatmap-tooltip" class="steam-heatmap-tooltip"></div>
              <div id="steam-heatmap-loading" class="steam-heatmap-status">
                <span class="loading loading-spinner loading-md opacity-50"></span>
              </div>
              <div id="steam-heatmap-empty" class="steam-heatmap-status" style="display: none;">
                <span class="text-xs opacity-50">ÊöÇÊó†Êï∞ÊçÆ</span>
              </div>
              <div id="steam-heatmap-error" class="steam-heatmap-status" style="display: none;">
                <span class="text-xs text-error opacity-50">Âä†ËΩΩÂ§±Ë¥•</span>
              </div>
            </div>
            <div class="steam-heatmap-legend">
              <span class="steam-legend-text">Less</span>
              <span class="steam-legend-dot l0"></span>
              <span class="steam-legend-dot l1"></span>
              <span class="steam-legend-dot l2"></span>
              <span class="steam-legend-dot l3"></span>
              <span class="steam-legend-text">More</span>
            </div>
          </div>
        </div>

      </div>

      <!-- ================================ -->
      <!-- Âè≥‰æßËæπÊ†è                          -->
      <!-- ================================ -->
      <div class="steam-sidebar">

        <!-- ÂæΩÁ´†Â±ïÁ§∫ - È™®Êû∂Â±è -->
        <div x-show="loading.badges" class="steam-sidebar-card">
          <div class="steam-sidebar-title">ÂæΩÁ´†</div>
          <div class="steam-badges-grid">
            <template x-for="i in 8" :key="i">
              <div class="skeleton w-10 h-10 rounded"></div>
            </template>
          </div>
        </div>

        <!-- ÂæΩÁ´†Â±ïÁ§∫ - ÂÆûÈôÖÂÜÖÂÆπ -->
        <div x-show="!loading.badges && badges?.badges?.length > 0" x-cloak class="steam-sidebar-card">
          <div class="steam-sidebar-title">
            ÂæΩÁ´† <span x-text="badges?.totalBadges || 0">0</span>
          </div>
          <div class="steam-badges-grid">
            <template x-for="(badge, index) in (badges?.badges || []).slice(0, 8)" :key="index">
              <div class="steam-badge-item" :title="(badge.badgeName || badge.displayName) + ' Lv.' + badge.level">
                <img x-show="badge.imageUrl" :src="badge.imageUrl" :alt="badge.displayName"
                     loading="lazy" decoding="async" class="steam-badge-img" />
              </div>
            </template>
          </div>
        </div>

        <!-- ÁªüËÆ°‰ø°ÊÅØ - È™®Êû∂Â±è -->
        <div x-show="loading.stats" class="steam-sidebar-card steam-stats-list">
          <div class="steam-stat-item">
            <span class="steam-stat-label">Ê∏∏Êàè</span>
            <span class="skeleton h-5 w-12"></span>
          </div>
          <div class="steam-stat-item">
            <span class="steam-stat-label">ÊÄªÊó∂Èïø</span>
            <span class="skeleton h-5 w-16"></span>
          </div>
          <div class="steam-stat-item">
            <span class="steam-stat-label">ÊúÄËøë2Âë®</span>
            <span class="skeleton h-5 w-14"></span>
          </div>
        </div>

        <!-- ÁªüËÆ°‰ø°ÊÅØ - ÂÆûÈôÖÂÜÖÂÆπ -->
        <div x-show="!loading.stats && stats" x-cloak class="steam-sidebar-card steam-stats-list">
          <div class="steam-stat-item">
            <span class="steam-stat-label">Ê∏∏Êàè</span>
            <span class="steam-stat-value" x-text="stats?.totalGames || 0">0</span>
          </div>
          <div class="steam-stat-item">
            <span class="steam-stat-label">ÊÄªÊó∂Èïø</span>
            <span class="steam-stat-value" x-text="((stats?.totalPlaytimeMinutes || 0) / 60).toFixed(1) + 'h'">0h</span>
          </div>
          <div class="steam-stat-item">
            <span class="steam-stat-label">ÊúÄËøë2Âë®</span>
            <span class="steam-stat-value text-primary" x-text="((stats?.recentPlaytimeMinutes || 0) / 60).toFixed(1) + 'h'">0h</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="max-w-6xl mx-auto px-4 pb-8">
    <!-- ========================================== -->
    <!--     ÊúÄËøëÊ∏∏Áé© - ÁΩëÊ†ºÂç°ÁâáÂ∏ÉÂ±Ä               -->
    <!-- ========================================== -->
    <section class="steam-section steam-animate-in steam-stagger-1">
      <div class="steam-section-header">
        <div class="steam-section-icon recent">
          <span class="icon-[heroicons--clock] w-5 h-5"></span>
        </div>
        <h2 class="steam-section-title">ÊúÄËøëÊ∏∏Áé©</h2>
      </div>

      <!-- È™®Êû∂Â±è -->
      <div x-show="loading.recent" class="steam-library-grid">
        <template x-for="i in 6" :key="i">
          <div class="steam-game-card">
            <div class="steam-game-card-image">
              <div class="skeleton w-full h-full"></div>
            </div>
            <div class="steam-game-card-info">
              <div class="skeleton h-4 w-3/4 mb-2"></div>
              <div class="skeleton h-3 w-1/2"></div>
            </div>
          </div>
        </template>
      </div>

      <!-- ÂÆûÈôÖÂÜÖÂÆπ -->
      <div x-show="!loading.recent && recentGames.length > 0" x-cloak class="steam-library-grid">
        <template x-for="(game, idx) in recentGames.filter(g => g.appid).slice(0, 10)" :key="game.appid + '-' + idx">
          <a :href="'https://store.steampowered.com/app/' + game.appid" target="_blank" class="steam-game-card">
            <div class="steam-game-card-image">
              <img :src="game.headerImageUrl" :alt="game.name" loading="lazy" decoding="async" class="steam-game-img" />
            </div>
            <div class="steam-game-card-info">
              <div class="steam-game-card-name" x-text="game.name">Game</div>
              <div class="steam-game-card-meta">
                <span class="steam-game-card-playtime" x-text="game.playtime2WeeksFormatted">0h</span>
              </div>
              <div class="steam-game-card-achievement-row" x-show="game.achievementProgressText">
                <span class="steam-game-card-achievement" x-text="game.achievementProgressText"></span>
                <div class="steam-achievement-bar" :data-progress="game.achievementProgressText">
                  <div class="steam-achievement-fill" :style="'width:' + getAchievementPercent(game.achievementProgressText) + '%'"></div>
                </div>
              </div>
            </div>
          </a>
        </template>
      </div>

      <!-- Á©∫Áä∂ÊÄÅ -->
      <div x-show="!loading.recent && recentGames.length === 0" x-cloak class="steam-empty-state">
        <div class="steam-empty-icon">üéÆ</div>
        <div class="steam-empty-title">ÊöÇÊó†ÊúÄËøëÊ∏∏Áé©</div>
      </div>
    </section>

    <!-- ========================================== -->
    <!--     Ê∏∏ÊàèÂ∫ì - ÁΩëÊ†ºÂç°ÁâáÂ∏ÉÂ±Ä                 -->
    <!-- ========================================== -->
    <section class="steam-section steam-animate-in steam-stagger-2">
      <div class="steam-section-header">
        <div class="steam-section-icon library">
          <span class="icon-[heroicons--squares-2x2] w-5 h-5"></span>
        </div>
        <h2 class="steam-section-title">Ê∏∏ÊàèÂ∫ì</h2>
      </div>

      <!-- È™®Êû∂Â±è -->
      <div x-show="loading.games" class="steam-library-grid">
        <template x-for="i in 12" :key="i">
          <div class="steam-game-card">
            <div class="steam-game-card-image">
              <div class="skeleton w-full h-full"></div>
            </div>
            <div class="steam-game-card-info">
              <div class="skeleton h-4 w-3/4 mb-2"></div>
              <div class="skeleton h-3 w-1/2"></div>
            </div>
          </div>
        </template>
      </div>

      <!-- ÂÆûÈôÖÂÜÖÂÆπ -->
      <div x-show="!loading.games && games.items.length > 0" x-cloak class="steam-library-grid">
        <template x-for="(game, idx) in games.items.filter(g => (g.appid || g.appId) && g.headerImageUrl)" :key="(game.appid || game.appId) + '-games-' + idx">
          <a th:if="${enableGameLink}" :href="'https://store.steampowered.com/app/' + (game.appid || game.appId)" target="_blank" class="steam-game-card">
            <div class="steam-game-card-image">
              <img :src="game.headerImageUrl" :alt="game.name" loading="lazy" decoding="async" class="steam-game-img" />
            </div>
            <div class="steam-game-card-info">
              <div class="steam-game-card-name" x-text="game.name">Game</div>
              <div class="steam-game-card-meta">
                <span class="steam-game-card-playtime" x-text="game.playtimeFormatted">0h</span>
                <span x-show="game.lastPlayedFormatted" class="steam-game-card-lastplayed" x-text="game.lastPlayedFormatted"></span>
              </div>
            </div>
          </a>
        </template>
      </div>

      <!-- Á©∫Áä∂ÊÄÅ -->
      <div x-show="!loading.games && games.items.length === 0" x-cloak class="steam-empty-state">
        <div class="steam-empty-icon">üéÆ</div>
        <div class="steam-empty-title">ÊöÇÊó†Ê∏∏ÊàèÊï∞ÊçÆ</div>
        <div class="steam-empty-desc">Ê∏∏ÊàèÂ∫ì‰∏∫Á©∫ÔºåËØ∑Ê£ÄÊü• Steam Ë¥¶Âè∑ËÆæÁΩÆ</div>
      </div>

      <!-- ÂàÜÈ°µ -->
      <div x-show="games?.totalPages > 1" x-cloak class="steam-pagination">
        <div class="steam-pagination-inner">
          <button @click="loadGames(games.page - 1)" :disabled="games?.page <= 1"
            class="steam-pagination-btn" :class="games?.page <= 1 ? 'opacity-30 cursor-not-allowed' : ''">
            <span class="icon-[heroicons--chevron-left] w-5 h-5"></span>
          </button>
          <span class="steam-pagination-info">
            <span x-text="games?.page || 1">1</span> / <span x-text="games?.totalPages || 1">1</span>
          </span>
          <button @click="loadGames(games.page + 1)" :disabled="games?.page >= games?.totalPages"
            class="steam-pagination-btn" :class="games?.page >= games?.totalPages ? 'opacity-30 cursor-not-allowed' : ''">
            <span class="icon-[heroicons--chevron-right] w-5 h-5"></span>
          </button>
        </div>
      </div>
    </section>
  </div>

  <!-- ÈÖçÁΩÆÊï∞ÊçÆ -->
  <script th:inline="javascript">
    window.steamPageConfig = {
      recentGamesLimit: /*[[${recentGamesLimit ?: 10}]]*/ 10,
      gamesPageSize: /*[[${gamesPageSize ?: 20}]]*/ 20,
      enableGameLink: /*[[${enableGameLink != false}]]*/ true
    };
  </script>
</main>

</html>
