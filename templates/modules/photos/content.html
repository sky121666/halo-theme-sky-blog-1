<!-- ========================================== -->
<!--        图库页面内容                         -->
<!-- 使用插件提供的 photos/groups 变量            -->
<!-- 分页数量在 Console → 插件 → 图库 → 设置     -->
<!-- ========================================== -->
<th:block th:fragment="content">

  <th:block th:with="
    cfg=${theme.config.photos_settings},
    pageTitle=${cfg?.page_title ?: '图库'},
    pageDesc=${cfg?.page_description ?: '记录生活中的美好瞬间'},
    showPhotoInfo=${cfg?.show_photo_info != false},
    enableComment=${cfg?.enable_comment == true}
  ">

    <div class="w-full px-4 md:px-6 lg:px-8 py-8 md:py-12">

      <!-- 页面标题区域 -->
      <header class="text-center mb-12">
        <h1 class="text-3xl md:text-4xl lg:text-5xl font-bold text-base-content mb-4" th:text="${pageTitle}">图库</h1>
        <p class="text-base-content/60 text-lg max-w-2xl mx-auto" th:text="${pageDesc}">记录生活中的美好瞬间</p>
        <p class="text-base-content/40 text-sm mt-2" th:if="${photos != null && photos.total > 0}">
          共 <span th:text="${photos.total}">0</span> 张照片
        </p>
      </header>

      <!-- 分组切换 -->
      <div th:if="${groups != null && #lists.size(groups) > 1}" class="mb-8">
        <div class="flex flex-wrap justify-center gap-2">
          <a th:href="@{/photos}" class="btn btn-sm"
            th:classappend="${param.group == null || #lists.isEmpty(param.group)} ? 'btn-primary' : 'btn-ghost'">
            全部
          </a>
          <th:block th:each="group : ${groups}">
            <a th:href="@{/photos(group=${group.metadata.name})}" class="btn btn-sm"
              th:classappend="${param.group != null && !#lists.isEmpty(param.group) && param.group[0] == group.metadata.name} ? 'btn-primary' : 'btn-ghost'"
              th:text="${group.spec.displayName}">
              分组
            </a>
          </th:block>
        </div>
      </div>

      <!-- 图片网格 (瀑布流全宽) -->
      <div th:if="${photos != null && photos.total > 0}" id="photo-grid"
        class="columns-2 sm:columns-3 md:columns-4 lg:columns-5 xl:columns-6 gap-1.5">
        <th:block th:each="photo : ${photos.items}">
          <div class="photo-item">
            <figure class="photo-card">
              <img th:src="${photo.spec.url}" th:alt="${photo.spec.displayName}" th:data-src="${photo.spec.url}"
                th:data-sub-html="${photo.spec.displayName != null ? '<h4>' + photo.spec.displayName + '</h4>' + (photo.spec.description != null ? '<p>' + photo.spec.description + '</p>' : '') : ''}"
                class="photo-img" loading="lazy" />
              <figcaption th:if="${showPhotoInfo}" class="photo-info">
                <h3 th:if="${photo.spec.displayName}" th:text="${photo.spec.displayName}">照片标题</h3>
                <p th:if="${photo.spec.description}" th:text="${photo.spec.description}">照片描述</p>
              </figcaption>
            </figure>
          </div>
        </th:block>
      </div>

      <!-- 分页导航 -->
      <div th:if="${photos != null && (photos.hasPrevious() || photos.hasNext())}"
        class="flex justify-center items-center gap-6 mt-12">
        <!-- 上一页 -->
        <a th:href="@{${photos.prevUrl}}"
          class="inline-flex items-center gap-1 text-sm text-base-content/60 hover:text-base-content hover:font-medium transition-all"
          th:classappend="${!photos.hasPrevious()} ? ' pointer-events-none opacity-40' : ''">
          <span class="icon-[heroicons--chevron-left] w-4 h-4"></span>
          <span>上一页</span>
        </a>
        <!-- 页码 -->
        <span class="text-sm text-base-content/50" th:text="${photos.page} + ' / ' + ${photos.totalPages}">1/1</span>
        <!-- 下一页 -->
        <a th:href="@{${photos.nextUrl}}"
          class="inline-flex items-center gap-1 text-sm text-base-content/60 hover:text-base-content hover:font-medium transition-all"
          th:classappend="${!photos.hasNext()} ? ' pointer-events-none opacity-40' : ''">
          <span>下一页</span>
          <span class="icon-[heroicons--chevron-right] w-4 h-4"></span>
        </a>
      </div>

      <!-- 空状态 -->
      <div th:if="${photos == null || photos.total == 0}" class="text-center py-20">
        <span class="icon-[mdi--image-off-outline] w-16 h-16 text-base-content/30 mx-auto mb-4"></span>
        <p class="text-base-content/50 text-lg">暂无照片</p>
        <p class="text-base-content/30 text-sm mt-2">请在后台添加照片</p>
      </div>

      <!-- 评论区（仅当未启用抽屉式评论时显示内嵌评论） -->
      <section
        th:if="${enableComment and !(cfg?.floating_dock?.enable_custom_dock == true and cfg?.floating_dock?.enable_comment == true)}"
        class="mt-16 max-w-4xl mx-auto">
        <h2 class="text-xl font-bold text-base-content mb-6 flex items-center gap-2">
          <span class="icon-[mdi--comment-text-outline] w-5 h-5 text-primary"></span>
          评论留言
        </h2>
        <div class="card bg-base-100/60 backdrop-blur-xl shadow-xl border border-base-content/5 rounded-[1.5rem]">
          <div class="card-body p-6 sm:p-8">
            <halo:comment group="content.halo.run" kind="SinglePage"
              th:attr="name=${singlePage != null ? singlePage.metadata.name : 'photos'}" colorScheme="system">
            </halo:comment>
          </div>
        </div>
      </section>

    </div>

    <!-- 评论抽屉（仅当启用定制悬浮栏 + 启用评论按钮时显示，启用即为抽屉式） -->
    <th:block th:if="${cfg?.floating_dock?.enable_custom_dock == true 
                       and cfg?.floating_dock?.enable_comment == true}">
      <th:block
        th:replace="~{modules/floating-dock :: commentDrawer('SinglePage', ${singlePage != null ? singlePage.metadata.name : 'photos'})}" />
    </th:block>

  </th:block>

</th:block>