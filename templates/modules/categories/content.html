<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org">

<!-- ========================================== -->
<!--        分类页主体内容（索引与归档）          -->
<!-- 说明：结构参考 modules/post/content.html      -->
<!-- ========================================== -->

<!-- 
  模板系统说明：
  
  1. 模板文件：
     - category.html（默认）→ 使用后台设置动态选择样式
     - category-card.html → 强制使用卡片风格
     - category-list.html → 强制使用列表风格
  
  2. 后台默认设置（全局默认）
     - 位置：主题设置 → 列表设置 → 默认分类列表风格
     - 可选：卡片、列表
     - 应用于：category.html 和 /categories（全部）页面
  
  3. 自定义模板（针对特定分类）
     - 位置：分类管理 → 编辑分类 → 自定义模板
     - 可选：卡片风格、列表风格
     - 效果：直接关联到对应的模板文件（category-card.html 或 category-list.html）
  
  4. 功能配置（所有模板共享）
     - 侧边栏显示/隐藏：show_sidebar
     - 封面图回退策略：cover_fallback
     - 每页文章数量：page_size
-->

<!-- 分类集合内容片段：/categories -->
<main class="relative" th:fragment="category-collection"
  th:with="cfg = ${theme.config.category_settings},
               globalSidebarCfg = ${theme.config.general.sidebar_settings},
               useCustomSidebar = ${cfg?.enable_custom_sidebar == true},
               sidebarPosition = ${useCustomSidebar ? (cfg?.sidebar_position ?: 'right') : (globalSidebarCfg?.position ?: 'right')}">
  <!-- 简约样式：不使用页头 Banner，直接展示分类按钮与列表 -->

  <!-- 主体内容区域（两列布局，与 post 一致） -->
  <div class="max-w-7xl mx-auto px-4 py-8">
    <div class="flex gap-8 lazy-anim" th:classappend="${sidebarPosition == 'left'} ? 'flex-row-reverse' : ''">
      <!-- 左侧：分类按钮与全部文章前 N（后台配置），并提供更多链接 -->
      <section class="flex-1" th:classappend="${cfg.show_sidebar == false ? 'max-w-6xl mx-auto' : ''}">
        <th:block th:with="categories = ${categoryFinder.listAsTree()}">
          <!-- 分类切换块 - 根据后台设置渲染不同风格 -->
          <th:block th:switch="${theme.config.category_settings.category_display_style}">
            <th:block th:case="'pills'">
              <th:block th:replace="~{modules/categories/category-switch :: pills(${categories}, null)}" />
            </th:block>
            <th:block th:case="'chips'">
              <th:block th:replace="~{modules/categories/category-switch :: chips(${categories}, null)}" />
            </th:block>
            <th:block th:case="'underline'">
              <th:block th:replace="~{modules/categories/category-switch :: underline(${categories}, null)}" />
            </th:block>
            <th:block th:case="'glass'">
              <th:block th:replace="~{modules/categories/category-switch :: glass(${categories}, null)}" />
            </th:block>
            <th:block th:case="*">
              <th:block th:replace="~{modules/categories/category-switch :: pills(${categories}, null)}" />
            </th:block>
          </th:block>

          <!-- 无分类提示 -->
          <th:block th:if="${#lists.isEmpty(categories)}">
            <div class="mt-6 flex items-center justify-center">
              <span class="text-sm font-light text-gray-600" th:text="#{page.categories.empty}">暂无分类</span>
            </div>
          </th:block>

          <!-- 有分类：在 /categories（全部）分页显示所有文章，风格由后台设置 -->
          <th:block th:unless="${#lists.isEmpty(categories)}" th:with="pageSize=${site.post.categoryPageSize}, 
                             pageParam=${param.page != null and !#lists.isEmpty(param.page) ? param.page[0] : '1'}, 
                             currentPage=${#numbers.formatInteger(pageParam, 0)}, 
                             posts=${postFinder.list({page: currentPage, size: pageSize})}">
            <!-- 动态渲染不同风格的列表 - 使用后台默认设置 -->
            <th:block th:switch="${theme.config.category_settings.list_style}">
              <th:block th:case="'modern'">
                <th:block
                  th:replace="~{modules/categories/list-modern :: modern(${posts}, ${theme.config.category_settings})}" />
              </th:block>
              <th:block th:case="'media_text'">
                <th:block
                  th:replace="~{modules/categories/list-media :: media_text(${posts}, ${theme.config.category_settings})}" />
              </th:block>
              <th:block th:case="'magazine'">
                <th:block
                  th:replace="~{modules/categories/list-magazine :: magazine(${posts}, ${theme.config.category_settings})}" />
              </th:block>
              <th:block th:case="'minimal'">
                <th:block
                  th:replace="~{modules/categories/list-minimal :: minimal(${posts}, ${theme.config.category_settings})}" />
              </th:block>
              <th:block th:case="*">
                <!-- 默认使用列表风格 -->
                <th:block
                  th:replace="~{modules/categories/list-media :: media_text(${posts}, ${theme.config.category_settings})}" />
              </th:block>
            </th:block>

            <!-- 无文章提示 -->
            <div th:if="${posts.total == 0}" class="mt-6 flex items-center justify-center">
              <span class="text-sm font-light text-gray-600" th:text="#{common.noPosts}">暂无文章</span>
            </div>

            <!-- 分页：上一页/下一页 + 下拉选择（索引页） -->
            <th:block th:replace="~{modules/categories/pagination :: pagination(
                context=@{/categories/},
                prevUrl=@{/categories(page=${posts.page - 1})},
                nextUrl=@{/categories(page=${posts.page + 1})},
                totalPages=${posts.totalPages},
                page=${posts.page},
                hasPrevious=${posts.hasPrevious},
                hasNext=${posts.hasNext}
            )}" />
          </th:block>
        </th:block>
      </section>

      <!-- 右侧：通用功能区块（不含文章目录） -->
      <aside th:if="${cfg.show_sidebar != false}" class="right-sidebar w-80 space-y-6 hidden lg:block sticky top-20 self-start">
        <th:block th:replace="~{modules/widgets/sidebar :: dynamic(${cfg})}" />
      </aside>
    </div>
  </div>
</main>

<!-- 分类归档内容片段：/categories/:slug -->
<main class="relative" th:fragment="category-archive"
  th:with="cfg = ${theme.config.category_settings},
               globalSidebarCfg = ${theme.config.general.sidebar_settings},
               useCustomSidebar = ${cfg?.enable_custom_sidebar == true},
               sidebarPosition = ${useCustomSidebar ? (cfg?.sidebar_position ?: 'right') : (globalSidebarCfg?.position ?: 'right')}">
  <!-- 简约样式：不使用页头 Banner，直接展示分类按钮与当前分类列表 -->

  <!-- 主体内容区域（与 post 一致的两列布局） -->
  <div class="max-w-7xl mx-auto px-4 py-8">
    <div class="flex gap-8" th:classappend="${sidebarPosition == 'left'} ? 'flex-row-reverse' : ''">
      <!-- 左侧：分类按钮与当前分类文章列表（分页） -->
      <section class="flex-1"
        th:classappend="${theme.config.category_settings.show_sidebar == false ? 'max-w-6xl mx-auto' : ''}">
        <!-- 分类切换块 - 根据后台设置渲染不同风格 -->
        <th:block th:with="categories=${categoryFinder.listAsTree()}">
          <th:block th:switch="${theme.config.category_settings.category_display_style}">
            <th:block th:case="'pills'">
              <th:block th:replace="~{modules/categories/category-switch :: pills(${categories}, ${category})}" />
            </th:block>
            <th:block th:case="'chips'">
              <th:block th:replace="~{modules/categories/category-switch :: chips(${categories}, ${category})}" />
            </th:block>
            <th:block th:case="'underline'">
              <th:block th:replace="~{modules/categories/category-switch :: underline(${categories}, ${category})}" />
            </th:block>
            <th:block th:case="'glass'">
              <th:block th:replace="~{modules/categories/category-switch :: glass(${categories}, ${category})}" />
            </th:block>
            <th:block th:case="*">
              <th:block th:replace="~{modules/categories/category-switch :: pills(${categories}, ${category})}" />
            </th:block>
          </th:block>
        </th:block>

        <!-- 文章列表（当前分类）：使用后台默认设置 -->
        <th:block th:switch="${theme.config.category_settings.list_style}">
          <th:block th:case="'modern'">
            <th:block
              th:replace="~{modules/categories/list-modern :: modern(${posts}, ${theme.config.category_settings})}" />
          </th:block>
          <th:block th:case="'media_text'">
            <th:block
              th:replace="~{modules/categories/list-media :: media_text(${posts}, ${theme.config.category_settings})}" />
          </th:block>
          <th:block th:case="'magazine'">
            <th:block
              th:replace="~{modules/categories/list-magazine :: magazine(${posts}, ${theme.config.category_settings})}" />
          </th:block>
          <th:block th:case="'minimal'">
            <th:block
              th:replace="~{modules/categories/list-minimal :: minimal(${posts}, ${theme.config.category_settings})}" />
          </th:block>
          <th:block th:case="*">
            <!-- 默认使用卡片风格 -->
            <th:block
              th:replace="~{modules/categories/list-modern :: modern(${posts}, ${theme.config.category_settings})}" />
          </th:block>
        </th:block>

        <!-- 分页（案例片段复用） -->
        <th:block th:replace="~{modules/categories/pagination :: pagination(
            context=@{/categories/{slug}/(slug=${category.metadata.name})},
            prevUrl=${posts.prevUrl},
            nextUrl=${posts.nextUrl},
            totalPages=${posts.totalPages},
            page=${posts.page},
            hasPrevious=${posts.hasPrevious},
            hasNext=${posts.hasNext}
        )}" />
      </section>

      <!-- 右侧：通用功能区块（不含文章目录） -->
      <aside th:if="${cfg.show_sidebar != false}" class="right-sidebar w-80 space-y-6 hidden lg:block sticky top-20 self-start">
        <th:block th:replace="~{modules/widgets/sidebar :: dynamic(${cfg})}" />
      </aside>
    </div>
  </div>
</main>

<!-- 分类归档内容片段：/categories/:slug - 强制卡片风格 -->
<main class="relative" th:fragment="category-archive-card"
  th:with="cfg = ${theme.config.category_settings},
               globalSidebarCfg = ${theme.config.general.sidebar_settings},
               useCustomSidebar = ${cfg?.enable_custom_sidebar == true},
               sidebarPosition = ${useCustomSidebar ? (cfg?.sidebar_position ?: 'right') : (globalSidebarCfg?.position ?: 'right')}">
  <!-- 简约样式：不使用页头 Banner，直接展示分类按钮与当前分类列表 -->

  <!-- 主体内容区域（与 post 一致的两列布局） -->
  <div class="max-w-7xl mx-auto px-4 py-8">
    <div class="flex gap-8" th:classappend="${sidebarPosition == 'left'} ? 'flex-row-reverse' : ''">
      <!-- 左侧：分类按钮与当前分类文章列表（分页） -->
      <section class="flex-1"
        th:classappend="${theme.config.category_settings.show_sidebar == false ? 'max-w-6xl mx-auto' : ''}">
        <!-- 分类切换块 -->
        <th:block th:with="categories=${categoryFinder.listAsTree()}">
          <th:block th:switch="${theme.config.category_settings.category_display_style}">
            <th:block th:case="'pills'">
              <th:block th:replace="~{modules/categories/category-switch :: pills(${categories}, ${category})}" />
            </th:block>
            <th:block th:case="'chips'">
              <th:block th:replace="~{modules/categories/category-switch :: chips(${categories}, ${category})}" />
            </th:block>
            <th:block th:case="'underline'">
              <th:block th:replace="~{modules/categories/category-switch :: underline(${categories}, ${category})}" />
            </th:block>
            <th:block th:case="'glass'">
              <th:block th:replace="~{modules/categories/category-switch :: glass(${categories}, ${category})}" />
            </th:block>
            <th:block th:case="*">
              <th:block th:replace="~{modules/categories/category-switch :: pills(${categories}, ${category})}" />
            </th:block>
          </th:block>
        </th:block>

        <!-- 文章列表（当前分类）：强制使用卡片风格 -->
        <th:block
          th:replace="~{modules/categories/list-modern :: modern(${posts}, ${theme.config.category_settings})}" />

        <!-- 分页（案例片段复用） -->
        <th:block th:replace="~{modules/categories/pagination :: pagination(
            context=@{/categories/{slug}/(slug=${category.metadata.name})},
            prevUrl=${posts.prevUrl},
            nextUrl=${posts.nextUrl},
            totalPages=${posts.totalPages},
            page=${posts.page},
            hasPrevious=${posts.hasPrevious},
            hasNext=${posts.hasNext}
        )}" />
      </section>

      <!-- 右侧：通用功能区块（不含文章目录） -->
      <aside th:if="${cfg.show_sidebar != false}" class="right-sidebar w-80 space-y-6 hidden lg:block sticky top-20 self-start">
        <th:block th:replace="~{modules/widgets/sidebar :: dynamic(${cfg})}" />
      </aside>
    </div>
  </div>
</main>

<!-- 分类归档内容片段：/categories/:slug - 强制列表风格 -->
<main class="relative" th:fragment="category-archive-list"
  th:with="cfg = ${theme.config.category_settings},
               globalSidebarCfg = ${theme.config.general.sidebar_settings},
               useCustomSidebar = ${cfg?.enable_custom_sidebar == true},
               sidebarPosition = ${useCustomSidebar ? (cfg?.sidebar_position ?: 'right') : (globalSidebarCfg?.position ?: 'right')}">
  <!-- 简约样式：不使用页头 Banner，直接展示分类按钮与当前分类列表 -->

  <!-- 主体内容区域（与 post 一致的两列布局） -->
  <div class="max-w-7xl mx-auto px-4 py-8">
    <div class="flex gap-8" th:classappend="${sidebarPosition == 'left'} ? 'flex-row-reverse' : ''">
      <!-- 左侧：分类按钮与当前分类文章列表（分页） -->
      <section class="flex-1"
        th:classappend="${theme.config.category_settings.show_sidebar == false ? 'max-w-6xl mx-auto' : ''}">
        <!-- 分类切换块 -->
        <th:block th:with="categories=${categoryFinder.listAsTree()}">
          <th:block th:switch="${theme.config.category_settings.category_display_style}">
            <th:block th:case="'pills'">
              <th:block th:replace="~{modules/categories/category-switch :: pills(${categories}, ${category})}" />
            </th:block>
            <th:block th:case="'chips'">
              <th:block th:replace="~{modules/categories/category-switch :: chips(${categories}, ${category})}" />
            </th:block>
            <th:block th:case="'underline'">
              <th:block th:replace="~{modules/categories/category-switch :: underline(${categories}, ${category})}" />
            </th:block>
            <th:block th:case="'glass'">
              <th:block th:replace="~{modules/categories/category-switch :: glass(${categories}, ${category})}" />
            </th:block>
            <th:block th:case="*">
              <th:block th:replace="~{modules/categories/category-switch :: pills(${categories}, ${category})}" />
            </th:block>
          </th:block>
        </th:block>

        <!-- 文章列表（当前分类）：强制使用列表风格 -->
        <th:block
          th:replace="~{modules/categories/list-media :: media_text(${posts}, ${theme.config.category_settings})}" />

        <!-- 分页（案例片段复用） -->
        <th:block th:replace="~{modules/categories/pagination :: pagination(
            context=@{/categories/{slug}/(slug=${category.metadata.name})},
            prevUrl=${posts.prevUrl},
            nextUrl=${posts.nextUrl},
            totalPages=${posts.totalPages},
            page=${posts.page},
            hasPrevious=${posts.hasPrevious},
            hasNext=${posts.hasNext}
        )}" />
      </section>

      <!-- 右侧：通用功能区块（不含文章目录） -->
      <aside th:if="${cfg.show_sidebar != false}" class="right-sidebar w-80 space-y-6 hidden lg:block sticky top-20 self-start">
        <th:block th:replace="~{modules/widgets/sidebar :: dynamic(${cfg})}" />
      </aside>
    </div>
  </div>
</main>

<!-- 分类归档内容片段：/categories/:slug - 强制杂志风格 -->
<main class="relative" th:fragment="category-archive-magazine"
  th:with="cfg = ${theme.config.category_settings},
               globalSidebarCfg = ${theme.config.general.sidebar_settings},
               useCustomSidebar = ${cfg?.enable_custom_sidebar == true},
               sidebarPosition = ${useCustomSidebar ? (cfg?.sidebar_position ?: 'right') : (globalSidebarCfg?.position ?: 'right')}">
  <!-- 简约样式：不使用页头 Banner，直接展示分类按钮与当前分类列表 -->

  <!-- 主体内容区域（与 post 一致的两列布局） -->
  <div class="max-w-7xl mx-auto px-4 py-8">
    <div class="flex gap-8" th:classappend="${sidebarPosition == 'left'} ? 'flex-row-reverse' : ''">
      <!-- 左侧：分类按钮与当前分类文章列表（分页） -->
      <section class="flex-1"
        th:classappend="${theme.config.category_settings.show_sidebar == false ? 'max-w-6xl mx-auto' : ''}">
        <!-- 分类切换块 -->
        <th:block th:with="categories=${categoryFinder.listAsTree()}">
          <th:block th:switch="${theme.config.category_settings.category_display_style}">
            <th:block th:case="'pills'">
              <th:block th:replace="~{modules/categories/category-switch :: pills(${categories}, ${category})}" />
            </th:block>
            <th:block th:case="'chips'">
              <th:block th:replace="~{modules/categories/category-switch :: chips(${categories}, ${category})}" />
            </th:block>
            <th:block th:case="'underline'">
              <th:block th:replace="~{modules/categories/category-switch :: underline(${categories}, ${category})}" />
            </th:block>
            <th:block th:case="'glass'">
              <th:block th:replace="~{modules/categories/category-switch :: glass(${categories}, ${category})}" />
            </th:block>
            <th:block th:case="*">
              <th:block th:replace="~{modules/categories/category-switch :: pills(${categories}, ${category})}" />
            </th:block>
          </th:block>
        </th:block>

        <!-- 文章列表（当前分类）：强制使用杂志风格 -->
        <th:block
          th:replace="~{modules/categories/list-magazine :: magazine(${posts}, ${theme.config.category_settings})}" />

        <!-- 分页（案例片段复用） -->
        <th:block th:replace="~{modules/categories/pagination :: pagination(
            context=@{/categories/{slug}/(slug=${category.metadata.name})},
            prevUrl=${posts.prevUrl},
            nextUrl=${posts.nextUrl},
            totalPages=${posts.totalPages},
            page=${posts.page},
            hasPrevious=${posts.hasPrevious},
            hasNext=${posts.hasNext}
        )}" />
      </section>

      <!-- 右侧：通用功能区块（不含文章目录） -->
      <aside th:if="${cfg.show_sidebar != false}" class="right-sidebar w-80 space-y-6 hidden lg:block sticky top-20 self-start">
        <th:block th:replace="~{modules/widgets/sidebar :: dynamic(${cfg})}" />
      </aside>
    </div>
  </div>
</main>

<!-- 分类归档内容片段：/categories/:slug - 强制极简风格 -->
<main class="relative" th:fragment="category-archive-minimal"
  th:with="cfg = ${theme.config.category_settings},
               globalSidebarCfg = ${theme.config.general.sidebar_settings},
               useCustomSidebar = ${cfg?.enable_custom_sidebar == true},
               sidebarPosition = ${useCustomSidebar ? (cfg?.sidebar_position ?: 'right') : (globalSidebarCfg?.position ?: 'right')}">
  <!-- 简约样式：不使用页头 Banner，直接展示分类按钮与当前分类列表 -->

  <!-- 主体内容区域（与 post 一致的两列布局） -->
  <div class="max-w-7xl mx-auto px-4 py-8">
    <div class="flex gap-8" th:classappend="${sidebarPosition == 'left'} ? 'flex-row-reverse' : ''">
      <!-- 左侧：分类按钮与当前分类文章列表（分页） -->
      <section class="flex-1"
        th:classappend="${theme.config.category_settings.show_sidebar == false ? 'max-w-6xl mx-auto' : ''}">
        <!-- 分类切换块 -->
        <th:block th:with="categories=${categoryFinder.listAsTree()}">
          <th:block th:switch="${theme.config.category_settings.category_display_style}">
            <th:block th:case="'pills'">
              <th:block th:replace="~{modules/categories/category-switch :: pills(${categories}, ${category})}" />
            </th:block>
            <th:block th:case="'chips'">
              <th:block th:replace="~{modules/categories/category-switch :: chips(${categories}, ${category})}" />
            </th:block>
            <th:block th:case="'underline'">
              <th:block th:replace="~{modules/categories/category-switch :: underline(${categories}, ${category})}" />
            </th:block>
            <th:block th:case="'glass'">
              <th:block th:replace="~{modules/categories/category-switch :: glass(${categories}, ${category})}" />
            </th:block>
            <th:block th:case="*">
              <th:block th:replace="~{modules/categories/category-switch :: pills(${categories}, ${category})}" />
            </th:block>
          </th:block>
        </th:block>

        <!-- 文章列表（当前分类）：强制使用极简风格 -->
        <th:block
          th:replace="~{modules/categories/list-minimal :: minimal(${posts}, ${theme.config.category_settings})}" />

        <!-- 分页（案例片段复用） -->
        <th:block th:replace="~{modules/categories/pagination :: pagination(
            context=@{/categories/{slug}/(slug=${category.metadata.name})},
            prevUrl=${posts.prevUrl},
            nextUrl=${posts.nextUrl},
            totalPages=${posts.totalPages},
            page=${posts.page},
            hasPrevious=${posts.hasPrevious},
            hasNext=${posts.hasNext}
        )}" />
      </section>

      <!-- 右侧：通用功能区块（不含文章目录） -->
      <aside th:if="${cfg.show_sidebar != false}" class="right-sidebar w-80 space-y-6 hidden lg:block sticky top-20 self-start">
        <th:block th:replace="~{modules/widgets/sidebar :: dynamic(${cfg})}" />
      </aside>
    </div>
  </div>
</main>

</html>