<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org">

<!-- ========================================== -->
<!--        标签页主体内容（索引与归档）          -->
<!-- 说明：结构参考 modules/categories/content.html -->
<!-- ========================================== -->

<!-- 标签集合内容片段：/tags -->
<main class="relative" th:fragment="tag-collection"
      th:with="cfg = ${theme.config.tag_settings},
               globalSidebarCfg = ${theme.config.general.sidebar_settings},
               useCustomSidebar = ${cfg?.enable_custom_sidebar == true},
               sidebarPosition = ${useCustomSidebar ? (cfg?.sidebar_position ?: 'right') : (globalSidebarCfg?.position ?: 'right')}">
  <!-- 主体内容区域（两列布局） -->
  <div class="max-w-7xl mx-auto px-4 py-8">
    <div class="flex gap-8" th:classappend="${sidebarPosition == 'left'} ? 'flex-row-reverse' : ''">
      <!-- 左侧：标签切换块与文章列表 -->
      <section class="flex-1" th:classappend="${cfg.show_sidebar != true ? 'max-w-6xl mx-auto' : ''}">
        <th:block th:with="tags = ${tagFinder.listAll()}">
          
          <!-- 标签切换块 - 根据后台设置渲染不同风格 -->
          <th:block th:switch="${theme.config.tag_settings.tag_display_style}">
            <th:block th:case="'pills'">
              <th:block th:replace="~{modules/tags/tag-switch :: pills(${tags}, null)}" />
            </th:block>
            <th:block th:case="'chips'">
              <th:block th:replace="~{modules/tags/tag-switch :: chips(${tags}, null)}" />
            </th:block>
            <th:block th:case="'underline'">
              <th:block th:replace="~{modules/tags/tag-switch :: underline(${tags}, null)}" />
            </th:block>
            <th:block th:case="'glass'">
              <th:block th:replace="~{modules/tags/tag-switch :: glass(${tags}, null)}" />
            </th:block>
            <th:block th:case="*">
              <th:block th:replace="~{modules/tags/tag-switch :: pills(${tags}, null)}" />
            </th:block>
          </th:block>

          <!-- 无标签提示 -->
          <th:block th:if="${#lists.isEmpty(tags)}">
            <div class="mt-6 flex items-center justify-center">
              <span class="text-sm font-light text-base-content/60">暂无标签</span>
            </div>
          </th:block>

          <!-- 有标签：在 /tags（全部）分页显示所有文章 -->
          <th:block th:unless="${#lists.isEmpty(tags)}"
                    th:with="pageSize=${site.post.tagPageSize ?: 10}, 
                             pageParam=${param.page != null and !#lists.isEmpty(param.page) ? param.page[0] : '1'}, 
                             currentPage=${#numbers.formatInteger(pageParam, 0)}, 
                             posts=${postFinder.list({page: currentPage, size: pageSize})}">
            <!-- 动态渲染不同风格的列表 -->
            <th:block th:switch="${theme.config.tag_settings.list_style}">
              <th:block th:case="'modern'">
                <th:block th:replace="~{modules/categories/list-modern :: modern(${posts})}" />
              </th:block>
              <th:block th:case="'media_text'">
                <th:block th:replace="~{modules/categories/list-media :: media_text(${posts})}" />
              </th:block>
              <th:block th:case="'magazine'">
                <th:block th:replace="~{modules/categories/list-magazine :: magazine(${posts})}" />
              </th:block>
              <th:block th:case="'minimal'">
                <th:block th:replace="~{modules/categories/list-minimal :: minimal(${posts})}" />
              </th:block>
              <th:block th:case="*">
                <th:block th:replace="~{modules/categories/list-media :: media_text(${posts})}" />
              </th:block>
            </th:block>

            <!-- 无文章提示 -->
            <div th:if="${posts.total == 0}" class="mt-6 flex items-center justify-center">
              <span class="text-sm font-light text-base-content/60">暂无文章</span>
            </div>

            <!-- 分页 -->
            <th:block th:replace="~{modules/categories/pagination :: pagination(
                context=@{/tags/},
                prevUrl=@{/tags(page=${posts.page - 1})},
                nextUrl=@{/tags(page=${posts.page + 1})},
                totalPages=${posts.totalPages},
                page=${posts.page},
                hasPrevious=${posts.hasPrevious},
                hasNext=${posts.hasNext}
            )}" />
          </th:block>
        </th:block>
      </section>

      <!-- 右侧：侧边栏 -->
      <aside th:if="${cfg.show_sidebar == true}" 
             class="right-sidebar w-80 space-y-6 hidden lg:block">
        <th:block th:replace="~{modules/widgets/sidebar :: dynamic(${cfg})}" />
      </aside>
    </div>
  </div>
</main>

<!-- 标签归档内容片段：/tags/:slug -->
<main class="relative" th:fragment="tag-archive"
      th:with="cfg = ${theme.config.tag_settings},
               globalSidebarCfg = ${theme.config.general.sidebar_settings},
               useCustomSidebar = ${cfg?.enable_custom_sidebar == true},
               sidebarPosition = ${useCustomSidebar ? (cfg?.sidebar_position ?: 'right') : (globalSidebarCfg?.position ?: 'right')}">
  <!-- 主体内容区域 -->
  <div class="max-w-7xl mx-auto px-4 py-8">
    <div class="flex gap-8" th:classappend="${sidebarPosition == 'left'} ? 'flex-row-reverse' : ''">
      <!-- 左侧：标签切换块与当前标签文章列表 -->
      <section class="flex-1" th:classappend="${theme.config.tag_settings.show_sidebar != true ? 'max-w-6xl mx-auto' : ''}">
        
        <!-- 标签切换块 -->
        <th:block th:with="tags = ${tagFinder.listAll()}">
          <th:block th:switch="${theme.config.tag_settings.tag_display_style}">
            <th:block th:case="'pills'">
              <th:block th:replace="~{modules/tags/tag-switch :: pills(${tags}, ${tag})}" />
            </th:block>
            <th:block th:case="'chips'">
              <th:block th:replace="~{modules/tags/tag-switch :: chips(${tags}, ${tag})}" />
            </th:block>
            <th:block th:case="'underline'">
              <th:block th:replace="~{modules/tags/tag-switch :: underline(${tags}, ${tag})}" />
            </th:block>
            <th:block th:case="'glass'">
              <th:block th:replace="~{modules/tags/tag-switch :: glass(${tags}, ${tag})}" />
            </th:block>
            <th:block th:case="*">
              <th:block th:replace="~{modules/tags/tag-switch :: pills(${tags}, ${tag})}" />
            </th:block>
          </th:block>
        </th:block>

        <!-- 文章列表（当前标签） -->
        <th:block th:switch="${theme.config.tag_settings.list_style}">
          <th:block th:case="'modern'">
            <th:block th:replace="~{modules/categories/list-modern :: modern(${posts})}" />
          </th:block>
          <th:block th:case="'media_text'">
            <th:block th:replace="~{modules/categories/list-media :: media_text(${posts})}" />
          </th:block>
          <th:block th:case="'magazine'">
            <th:block th:replace="~{modules/categories/list-magazine :: magazine(${posts})}" />
          </th:block>
          <th:block th:case="'minimal'">
            <th:block th:replace="~{modules/categories/list-minimal :: minimal(${posts})}" />
          </th:block>
          <th:block th:case="*">
            <th:block th:replace="~{modules/categories/list-modern :: modern(${posts})}" />
          </th:block>
        </th:block>

        <!-- 分页 -->
        <th:block th:replace="~{modules/categories/pagination :: pagination(
            context=@{/tags/{slug}/(slug=${tag.metadata.name})},
            prevUrl=${posts.prevUrl},
            nextUrl=${posts.nextUrl},
            totalPages=${posts.totalPages},
            page=${posts.page},
            hasPrevious=${posts.hasPrevious},
            hasNext=${posts.hasNext}
        )}" />
      </section>

      <!-- 右侧：侧边栏 -->
      <aside th:if="${cfg.show_sidebar == true}" 
             class="right-sidebar w-80 space-y-6 hidden lg:block">
        <th:block th:replace="~{modules/widgets/sidebar :: dynamic(${cfg})}" />
      </aside>
    </div>
  </div>
</main>

</html>
