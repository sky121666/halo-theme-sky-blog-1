<!-- ========================================== -->
<!--    Gateway Fragments - Password Reset     -->
<!--    发送重置邮件表单 (Premium Style)        -->
<!-- ========================================== -->

<th:block th:fragment="form">
    <!-- 已发送状态 -->
    <form th:if="${sent}" method="get" action="/login" class="space-y-5">
        <div class="p-5 rounded-xl bg-success/10 border border-success/20 text-success text-sm flex items-start gap-3">
            <span class="icon-[heroicons--check-circle] w-6 h-6 shrink-0"></span>
            <div>
                <p class="font-semibold mb-1">邮件发送成功！</p>
                <p class="text-success/70">请检查您的收件箱，点击邮件中的链接重置密码。如未收到，请检查垃圾邮件文件夹。</p>
            </div>
        </div>
        <div class="pt-2">
            <button type="submit" class="premium-btn">
                返回登录
            </button>
        </div>
    </form>

    <!-- 发送表单 -->
    <form th:unless="${sent}" class="space-y-5" th:action="@{/password-reset/email}" method="post" th:object="${form}">
        <!-- 错误提示 -->
        <div class="p-4 rounded-xl bg-error/10 border border-error/20 text-error text-sm flex items-start gap-3"
            role="alert" th:if="${param.error.size() > 0}">
            <span class="icon-[heroicons--exclamation-circle] w-5 h-5 shrink-0 mt-0.5"></span>
            <span th:if="${param.error[0] == 'invalid_reset_token'}">重置链接无效或已过期，请重新发送</span>
        </div>
        <div class="p-4 rounded-xl bg-error/10 border border-error/20 text-error text-sm flex items-start gap-3"
            role="alert" th:if="${error}">
            <span class="icon-[heroicons--exclamation-circle] w-5 h-5 shrink-0 mt-0.5"></span>
            <span th:if="${error == 'rate_limit_exceeded'}">请求过于频繁，请稍后再试</span>
        </div>

        <!-- 邮箱输入 -->
        <div class="space-y-2">
            <label for="email" class="block text-sm font-medium text-base-content/70">邮箱地址</label>
            <input type="email" id="email" name="email" placeholder="请输入注册时使用的邮箱" autofocus required th:field="*{email}"
                class="premium-input" />
            <p class="text-xs text-error" th:if="${#fields.hasErrors('email')}" th:errors="*{email}"></p>
        </div>

        <!-- Altcha 验证码 -->
        <div halo:captcha class="w-full"></div>

        <!-- 提交按钮 -->
        <div class="pt-2">
            <button type="submit" class="premium-btn">
                发送重置链接
            </button>
        </div>
    </form>
</th:block>