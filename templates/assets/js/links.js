document.addEventListener("alpine:init",()=>{Alpine.data("linkSubmitForm",()=>({form:{type:"add",displayName:"",url:"",logo:"",email:"",description:"",rssUrl:"",groupName:""},groups:[],submitting:!1,result:{show:!1,success:!1,message:""},init(){this.fetchGroups()},async fetchGroups(){try{const s=await fetch("/apis/anonymous.link.submit.kunkunyu.com/v1alpha1/linkgroups");s.ok&&(this.groups=await s.json())}catch(s){console.warn("获取友链分组失败:",s)}},async submitLink(){this.submitting=!0,this.result.show=!1;try{const s=await fetch("/apis/anonymous.link.submit.kunkunyu.com/v1alpha1/linksubmits/-/submit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.form)});if(s.ok)this.result={show:!0,success:!0,message:"友链申请已提交，请等待站长审核！"},this.resetForm(),setTimeout(()=>{document.getElementById("link-submit-modal").close(),this.result.show=!1},3e3);else{const t=await s.json().catch(()=>({}));this.result={show:!0,success:!1,message:t.message||"提交失败，请稍后重试"}}}catch(s){this.result={show:!0,success:!1,message:"网络错误，请检查网络连接"}}finally{this.submitting=!1}},resetForm(){this.form={type:"add",displayName:"",url:"",logo:"",email:"",description:"",rssUrl:"",groupName:""}}}))}),document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".link-card img").forEach(s=>{s.addEventListener("error",()=>{s.style.display="none";const t=s.nextElementSibling;t&&(t.style.display="flex")})})});
