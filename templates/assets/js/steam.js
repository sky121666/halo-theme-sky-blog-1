document.addEventListener("alpine:init",()=>{Alpine.data("steamLibrary",()=>({handleScroll(e,s){e.deltaY!==0&&(s.scrollLeft+=e.deltaY)}}))});document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".steam-game-card img, .steam-recent-card img").forEach(e=>{e.addEventListener("error",function(){this.src='data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 460 215"%3E%3Crect fill="%231b2838" width="460" height="215"/%3E%3Ctext x="50%25" y="50%25" fill="%2366c0f4" font-size="24" text-anchor="middle" dy=".3em"%3EğŸ®%3C/text%3E%3C/svg%3E'})}),document.querySelectorAll(".steam-game-card img, .steam-recent-card img").forEach(e=>{e.complete?e.classList.add("loaded"):e.addEventListener("load",function(){this.classList.add("loaded")})}),y()});async function y(){const e=document.getElementById("steam-heatmap-grid"),s=document.getElementById("steam-heatmap-loading"),d=document.getElementById("steam-heatmap-empty"),a=document.getElementById("steam-heatmap-error"),c=document.getElementById("steam-heatmap-tooltip");if(e)try{const n=parseInt(e.dataset.days||"365",10),t=await E(n);if(s&&(s.style.display="none"),!t||!t.items||t.items.length===0){d&&(d.style.display="flex");return}const l=new Map;t.items.forEach(o=>{l.set(o.spec.date,o.spec.playtimeMinutes||0)}),D(e,l,n,c)}catch(n){console.error("Failed to render heatmap:",n),s&&(s.style.display="none"),a&&(a.style.display="flex")}}async function E(e){const s=new Date,d=new Date;d.setDate(d.getDate()-e);const a=t=>{const l=t.getFullYear(),o=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0");return`${l}-${o}-${r}`},c=`/apis/api.steam.halo.run/v1alpha1/heatmap/records?startDate=${a(d)}&endDate=${a(s)}&page=1&size=${e}`,n=await fetch(c);if(!n.ok)throw new Error("Failed to fetch heatmap data");return await n.json()}function D(e,s,d,a){const c=new Date,n=new Date;n.setDate(n.getDate()-d),e.innerHTML="";let t=new Date(n);const l=t.getDay();for(t.setDate(t.getDate()-l);t<=c;){const o=t.toISOString().split("T")[0],r=s.get(o)||0,p=(r/60).toFixed(1);let m=0;r>0&&(m=1),r>60&&(m=2),r>180&&(m=3),r>300&&(m=4);const i=document.createElement("div");i.className=`steam-heatmap-cell level-${m}`,i.dataset.date=o,i.dataset.hours=p,i.addEventListener("mouseenter",v=>{const f=i.getBoundingClientRect(),h=e.getBoundingClientRect();a.innerHTML=`
        <div class="font-bold">${o}</div>
        <div>æ¸¸æˆæ—¶é•¿: ${p} å°æ—¶</div>
      `,a.classList.remove("hidden");const g=f.top-h.top-a.offsetHeight-8,u=f.left-h.left+f.width/2-a.offsetWidth/2;a.style.top=`${g}px`,a.style.left=`${u}px`}),i.addEventListener("mouseleave",()=>{a.classList.add("hidden")}),e.appendChild(i),t.setDate(t.getDate()+1)}}
